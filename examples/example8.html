<!DOCTYPE html>
<html style="height: 100%;">

<head>
  
  
  
  <script type="text/javascript">
  //*** wozu ist das? Es geht auch ohne.  
    window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"199e8a4832","applicationID":"2972453","transactionName":"c11cQBFeWw5TSh9AWkVVW1oQHkQKWU8=","queueTime":0,"applicationTime":31,"agent":""}
  </script>
  
  
  
  <script type="text/javascript">    
  //*** wozu ist das? Es geht auch ohne.    
    window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(e,n){return function(){o(e,[(new Date).getTime()].concat(a(arguments)),null,n)}}var o=e("handle"),i=e(2),a=e(3);"undefined"==typeof window.newrelic&&(newrelic=NREUM);var c=["setPageViewName","setCustomAttribute","finished","addToTrace","inlineHit"],u=["addPageAction"],f="api-";i(c,function(e,n){newrelic[n]=r(f+n,"api")}),i(u,function(e,n){newrelic[n]=r(f+n)}),n.exports=newrelic,newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),o("err",[e,(new Date).getTime()])}},{}],2:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],3:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(0>o?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?c(e,a,i):i()}function t(t,r,o){e&&e(t,r,o);for(var i=n(o),a=l(t),c=a.length,u=0;c>u;u++)a[u].apply(i,r);var s=f[m[t]];return s&&s.push([w,t,r,i]),i}function p(e,n){g[e]=l(e).concat(n)}function l(e){return g[e]||[]}function d(e){return s[e]=s[e]||o(t)}function v(e,n){u(e,function(e,t){n=n||"feature",m[t]=n,n in f||(f[n]=[])})}var g={},m={},w={on:p,emit:t,get:d,listeners:l,context:n,buffer:v};return w}function i(){return new r}var a="nr@context",c=e("gos"),u=e(2),f={},s={},p=n.exports=o();p.backlog=f},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!b++){var e=y.info=NREUM.info,n=s.getElementsByTagName("script")[0];if(e&&e.licenseKey&&e.applicationID&&n){u(m,function(n,t){e[n]||(e[n]=t)});var t="https"===g.split(":")[0]||e.sslForHttp;y.proto=t?"https://":"http://",c("mark",["onload",a()],null,"api");var r=s.createElement("script");r.src=y.proto+e.agent,n.parentNode.insertBefore(r,n)}}}function o(){"complete"===s.readyState&&i()}function i(){c("mark",["domContent",a()],null,"api")}function a(){return(new Date).getTime()}var c=e("handle"),u=e(2),f=window,s=f.document,p="addEventListener",l="attachEvent",d=f.XMLHttpRequest,v=d&&d.prototype;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:d,REQ:f.Request,EV:f.Event,PR:f.Promise,MO:f.MutationObserver},e(1);var g=""+location,m={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-952.min.js"},w=d&&v&&v[p]&&!/CriOS/.test(navigator.userAgent),y=n.exports={offset:a(),origin:g,features:{},xhrWrappable:w};s[p]?(s[p]("DOMContentLoaded",i,!1),f[p]("load",r,!1)):(s[l]("onreadystatechange",o),f[l]("onload",r)),c("mark",["firstbyte",a()],null,"api");var b=0},{}]},{},["loader"]);
  </script>
  
  
  
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" src="//thingspeak.com/highcharts-3.0.8.js"></script>
  <script type="text/javascript" src="//thingspeak.com/exporting.js"></script>

  
  
  <style type="text/css">
    body { 
      background-color: white; 
      height: 100%; 
      margin: 0; 
      padding: 0; 
    }
    #chart-container { 
      /* width: 425px; */
      /* height: 235px; */
      width: 100%;
      height: 100%;
      display: block; 
      /* position:absolute; */
      bottom:0; 
      top:0; 
      left:0; 
      right:0; 
      margin: 5px 15px 15px 0; 
      overflow: hidden; 
    }
  </style>


  
  <script type="text/javascript">
    // 7 Tage
    var dataAnz = 8000;
    var gXTics = 3600000;
    var gXTics = 14400000;
    var mXTics = 3600000;
    var days = 1;
    var avVal = 5;
    
    // halbes Jahr
    // var dataAnz = 8000;
    // var gXTics = 84000000;
    // var mXTics = 42000000;
    // var days = 183;
    // var avVal = 30;
    
    // variables for the first series
    var series_1_channel_id = 30836;
    var series_1_field_number = 1;
    var series_1_read_api_key = 'EC30R8WJ5BK83MG9';
    var series_1_results = dataAnz;
    var series_1_color = '#d62020';
    var series_1_yaxis = 0;
    var series_1_R10 = 0;
    var series_1_gamma = 0;
    var series_1_av = avVal;
  
    // variables for the second series
    var series_2_channel_id = 30836;
    var series_2_field_number = 4;
    var series_2_read_api_key = 'EC30R8WJ5BK83MG9';
    var series_2_results = dataAnz;
    var series_2_color = '#d62020';
    var series_2_yaxis = 1;
    // var series_2_R10 = 38458;
    // var series_2_gamma = 0.61;
    // var series_2_R10 = 29458;
    // var series_2_gamma = 0.58;
    // var series_2_R10 = 8577.89487093433
    // var series_2_gamma = 0.49850587783985
    var series_2_R10 = 9979.21990350163;
    var series_2_gamma = 0.517897192204659;
    var series_2_av = avVal;
  
    // variables for the third series
    var series_3_channel_id = 33223;
    var series_3_field_number = 1;
    var series_3_read_api_key = 'K9PAOWOZL1CLVFNP';
    var series_3_results = dataAnz;
    var series_3_color = '#00aa00';
    var series_3_yaxis = 0;
    var series_3_R10 = 0;
    var series_3_gamma = 0;
    var series_3_av = avVal;
    
    // variables for the forth series
    var series_4_channel_id = 33223;
    var series_4_field_number = 4;
    var series_4_read_api_key = 'K9PAOWOZL1CLVFNP';
    var series_4_results = dataAnz;
    var series_4_color = '#00aa00';
    var series_4_yaxis = 1;
    // var series_4_R10 = 36167;
    // var series_4_gamma = 0.65;    
    // var series_4_R10 = 31360.5119668173
    // var series_4_gamma = 0.674161688417277       
    var series_4_R10 = 21352.2995766859;
    var series_4_gamma = 0.611889806561402;
    var series_4_av = avVal;
      
    // variables for the fifth series
    var series_5_channel_id = 40882;
    var series_5_field_number = 1;
    var series_5_read_api_key = 'X6CH2F15NWJHS1ST';
    var series_5_results = dataAnz;
    var series_5_color = '#d62020';
    var series_5_yaxis = 0;
    var series_5_R10 = 0;
    var series_5_gamma = 0;
    var series_5_av = avVal;
    
    // variables for the six series
    var series_6_channel_id = 40882;
    var series_6_field_number = 4;
    var series_6_read_api_key = 'X6CH2F15NWJHS1ST';
    var series_6_results = dataAnz;
    var series_6_color = '#aaaa66';
    var series_6_yaxis = 1;
    var series_6_R10 = 18514;
    var series_6_gamma = 0.56;
    var series_6_av = avVal;
      
    // chart title
    var chart_title = 'ESP8266 Weather Station with Arduino';
  
    // y axis title
    var y_axis_title = 'Temperature [Â°C]';
  
    // user's timezone offset
    var my_offset = new Date().getTimezoneOffset();
    
    // chart variable
    var my_chart;
  
    
    
    // when the document is ready
    $(document).on('ready', function() {
      // add a blank chart
      addChart();
      // add the first series
      // addSeries(series_1_channel_id, series_1_field_number, series_1_read_api_key, series_1_results, series_1_color, series_1_yaxis, series_1_R10, series_1_gamma, series_1_av);
      // add the second series
      // addSeries(series_2_channel_id, series_2_field_number, series_2_read_api_key, series_2_results, series_2_color, series_2_yaxis, series_2_R10, series_2_gamma, series_2_av);
      // add the second series
      // addSeries(series_3_channel_id, series_3_field_number, series_3_read_api_key, series_3_results, series_3_color, series_3_yaxis, series_3_R10, series_3_gamma, series_3_av);
      // add the second series
      // addSeries(series_4_channel_id, series_4_field_number, series_4_read_api_key, series_4_results, series_4_color, series_4_yaxis, series_4_R10, series_4_gamma, series_4_av);
      // add the second series
      addSeries(series_5_channel_id, series_5_field_number, series_5_read_api_key, series_5_results, series_5_color, series_5_yaxis, series_5_R10, series_5_gamma, series_5_av, "Temperature");
      // add the second series
      addSeries(series_6_channel_id, series_6_field_number, series_6_read_api_key, series_6_results, series_6_color, series_6_yaxis, series_6_R10, series_6_gamma, series_6_av, "Light Intensity");   
    });
  
    
    
    // add the base chart
    function addChart() {
      
      // variable for the local date in milliseconds
      var localDate;
  
      // specify the chart options
      var chartOptions = {
        
        chart: {
          renderTo: 'chart-container',
          defaultSeriesType: 'line',
          backgroundColor: '#ffffff',
          events: { }
        },
        
        title: { text: chart_title },
        
        plotOptions: {
          series: {
            marker: { radius: 1 },
            animation: true,
            step: false,
            borderWidth: 0,
            turboThreshold: 0
          }
        },
        
        tooltip: {
          // reformat the tooltips so that local times are displayed
          formatter: function() {
            var d = new Date(this.x + (my_offset*60000));
            var n = (this.point.name === undefined) ? '' : '<br>' + this.point.name;
            return this.series.name + ':<b>' + this.y + '</b>' + n + '<br>' + d.toDateString() + '<br>' + d.toTimeString().replace(/\(.*\)/, "");
          }
        },
        
        xAxis: {
          type: 'datetime',
          title: { text: 'Date' },
          tickInterval: gXTics,
          minorTickInterval: mXTics
        },
        
        yAxis: [{ 
          // title: { text: y_axis_title },
          title: { text: y_axis_title },
          min: -10,
          max: 40,
          tickInterval: 10,
          minorTickInterval: 2
        }, {
          title: { text: "Light Intensity" },
          type: 'logarithmic',
          min: 0.001,
          max: 100000,
          // max: 10000,
          opposite: true,
          tickInterval: 2
          // max: 30,
          // tickInterval: 20000,
          // minorTickInterval: 4000
        }],
        
        exporting: { enabled: true },
        legend: { 
          enabled: true,
          borderWidth: 0
        },
        
      };
  
      // draw the chart
      my_chart = new Highcharts.Chart(chartOptions);
    }
  
    // add a series to the chart
    function addSeries(channel_id, field_number, api_key, results, color, yAxisId, R10, gamma, av, chart_name) {
      var field_name = 'field' + field_number;
  
      // get the data with a webservice call
      // $.getJSON('https://api.thingspeak.com/channels/' + channel_id + '/fields/' + field_number + '.json?offset=0&round=2&average=' + av + '&days=' + days + '&results=' + results + '&api_key=' + api_key, function(data) {
      
      $.getJSON('https://api.thingspeak.com/channels/' + channel_id + '/fields/' + field_number + '.json?offset=0&round=2&median=' + av + '&days=' + days + '&api_key=' + api_key, function(data) {
  
        // blank array for holding chart data
        var chart_data = [];
  
      
        // iterate through each feed
        $.each(data.feeds, function() {
          
          var point = new Highcharts.Point();
          
          // set the proper values
          var value = this[field_name];
          point.x = getChartDate(this.created_at);
          
          yValue = parseFloat(value);
          
          if (field_number == 4) {
            yValue = ((1023*10000)/yValue)-10000;
            yValue = Math.pow(10,((Math.log10(R10/yValue))/gamma)+1);
            // yValue = Math.pow(10,(yValue/1023)*Math.log10(100000));
          }
          
          point.y = yValue;
          // add location if possible
          if (this.location) { point.name = this.location; }
          // if a numerical value exists add it
          if (!isNaN(parseInt(value))) { chart_data.push(point); }
        });
  
        
        // add the chart data
        my_chart.addSeries({ 
          data: chart_data,
          name: chart_name, 
          // name: data.channel[field_name], 
          color: color,
          yAxis: yAxisId
        });
      });
    }
  
    
    // converts date format from JSON
    function getChartDate(d) {
      // get the data using javascript's date object (year, month, day, hour, minute, second)
      // months in javascript start at 0, so remember to subtract 1 when specifying the month
      // offset in minutes is converted to milliseconds and subtracted so that chart's x-axis is correct
      return Date.UTC(d.substring(0,4), d.substring(5,7)-1, d.substring(8,10), d.substring(11,13), d.substring(14,16), d.substring(17,19)) - (my_offset * 60000);
    }
    
    
  </script>

</head>

<body>
  <div id="chart-container">
    <img alt="Ajax loader" src="//thingspeak.com/assets/loader-transparent.gif" style="position: absolute; margin: auto; top: 0; left: 0; right: 0; bottom: 0;" />
  </div>
</body>

</html>
